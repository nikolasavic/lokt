{"id":"lokt-0il","title":"L-103 lock: integrate validation in Acquire/Release","description":"## What\nCall ValidateName early in lock.Acquire() and lock.Release() functions.\n\n## Pattern\nMirror error handling pattern from existing code (return wrapped errors).\n\n## Acceptance\n- [ ] Acquire returns error for invalid name before any file ops\n- [ ] Release returns error for invalid name before any file ops\n- [ ] CLI shows clear error message to user","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T10:08:22.319806-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T10:12:18.310389-05:00","closed_at":"2026-01-27T10:12:18.310389-05:00","close_reason":"Validation integrated in Acquire/Release, CLI shows clear errors","dependencies":[{"issue_id":"lokt-0il","depends_on_id":"lokt-1um","type":"blocks","created_at":"2026-01-27T10:09:13.008349-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-1um","title":"L-103 lockfile: add ValidateName function","description":"## What\nAdd ValidateName(name string) error function to internal/lockfile package.\n\n## Pattern\n- Regex: `^[A-Za-z0-9._-]+$`\n- Check for `..` substring\n- Check for leading `/`\n- Check for empty string\n\n## Acceptance\n- [ ] Function returns nil for valid names\n- [ ] Function returns descriptive error for invalid names\n- [ ] Unit tests cover all edge cases","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T10:08:13.247571-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T10:11:02.363062-05:00","closed_at":"2026-01-27T10:11:02.363062-05:00","close_reason":"ValidateName function added with comprehensive tests (22 test cases)"}
{"id":"lokt-31a","title":"L-140 verify:sandbox","description":"Verification for L-140 lock --wait flag\n\nLinked story: lokt-eie\n\n## Scope\n- Agent-verifiable: CLI behavior, exit codes, signal handling\n- All verification can be done locally (sandbox)","notes":"linked-story: lokt-eie\nverify-level: optional","status":"open","priority":3,"issue_type":"epic","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T14:00:35.367153-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T14:00:35.367153-05:00"}
{"id":"lokt-31a.1","title":"L-140 verify:sandbox wait acquires after release","description":"## Check\nVerify `lokt lock --wait` acquires lock after holder releases it.\n\n## Command\n```bash\n# Terminal 1: Hold lock\nlokt lock test-wait\n\n# Terminal 2: Start wait (in background)\nlokt lock --wait test-wait \u0026\nWAIT_PID=$!\n\n# Terminal 1: Release after 1s\nsleep 1 \u0026\u0026 lokt unlock test-wait\n\n# Check wait process succeeded\nwait $WAIT_PID\necho \"Exit code: $?\"\n```\n\n## Expected\n- Wait command blocks until lock released\n- Exit code 0 after acquiring","notes":"env: sandbox\nverify: agent\nmaps-to-ac: basic-wait","status":"open","priority":3,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T14:00:44.613232-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T14:00:44.613232-05:00","dependencies":[{"issue_id":"lokt-31a.1","depends_on_id":"lokt-31a","type":"parent-child","created_at":"2026-01-27T14:00:44.616054-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-31a.2","title":"L-140 verify:sandbox signal cancels wait","description":"## Check\nVerify SIGINT cancels waiting cleanly.\n\n## Command\n```bash\n# Hold lock indefinitely\nlokt lock --ttl 1h signal-test\n\n# Start wait in background\nlokt lock --wait signal-test \u0026\nWAIT_PID=$!\nsleep 0.5\n\n# Send SIGINT\nkill -INT $WAIT_PID\nwait $WAIT_PID\necho \"Exit code: $?\"\n\n# Cleanup\nlokt unlock --force signal-test\n```\n\n## Expected\n- Wait command exits on SIGINT\n- Exit code is non-zero (1 or 130)","notes":"env: sandbox\nverify: agent\nmaps-to-ac: signal-handling","status":"open","priority":3,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T14:00:52.827199-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T14:00:52.827199-05:00","dependencies":[{"issue_id":"lokt-31a.2","depends_on_id":"lokt-31a","type":"parent-child","created_at":"2026-01-27T14:00:52.829363-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-b0a","title":"L-130 ttl-stale-handling","description":"## Summary\nImplement safe handling of stale/expired locks through TTL enforcement and PID liveness detection.\n\n## Acceptance Criteria\n- [ ] `unlock --break-stale` removes expired locks\n- [ ] `unlock --break-stale` refuses to break non-expired locks (exit code 1)\n- [ ] `unlock --break-stale` removes locks where PID is dead (same host only)\n- [ ] `status` shows PID liveness (alive/dead/unknown) on same host\n- [ ] `status --prune-expired` removes expired locks and reports them\n- [ ] `--ttl 0` or negative durations produce clear error\n- [ ] All new functionality has unit tests\n\n## Plan\n\n### Strategy\nBuild on existing TTL infrastructure (`Lock.IsExpired()`, `--ttl` flags) by adding:\n1. PID liveness detection in a new `internal/stale` package\n2. `--break-stale` option to Release()\n3. Status enhancement for liveness display\n4. Duration validation in command parsing\n\n### Patterns\n- Mirror: `internal/lock/release.go` for ownership check pattern\n- Mirror: `cmd/lokt/main.go:117` for flag handling pattern\n\n### Key Decisions\n- PID check only on same host (cross-host = unknown)\n- EPERM from kill(0) means process is alive (can't signal, but exists)\n- Windows: skip PID check, rely on TTL only\n\n## Edge Cases\n- Cross-host locks: Cannot verify PID - treat as unknown\n- PID reuse: Rare but TTL provides backup protection\n- Race conditions: Lock disappears between read/remove - handle gracefully\n- Permission errors: Cannot signal PID - treat as alive (safe default)\n\n## Constraints\n- No external dependencies for PID liveness\n- Must work on macOS and Linux\n- Windows fallback behavior\n- Backward compatible with existing lock files","notes":"source: _notes/story-drafts/l-130-ttl-stale-handling.md\nverify-level: agent\nverify-envs: local","status":"closed","priority":2,"issue_type":"epic","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:21:45.300561-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T09:24:18.028172-05:00","closed_at":"2026-01-27T09:24:18.028172-05:00","close_reason":"## Summary\nL-130 TTL \u0026 Stale Lock Handling complete.\n\n## Implemented\n- internal/stale package with PID liveness detection (Unix/Windows)\n- --break-stale flag for unlock (removes expired or dead-PID locks)\n- Status shows PID liveness (alive/dead/unknown)\n- --prune-expired flag for status (auto-cleanup expired locks)\n- TTL validation (rejects negative values)\n\n## Commits\n- 6a1a112 feat(stale): add stale lock detection package\n- dd995d0 feat(cli): add --break-stale flag to unlock command\n- ff2032b feat(cli): add liveness display, prune-expired, TTL validation\n\n## Verification\nAll 23 unit tests pass. CLI functionality verified.","labels":["L-130","story"]}
{"id":"lokt-b0a.1","title":"L-130 internal: add stale detection package","description":"## What\nCreate `internal/stale` package with PID liveness detection.\n\n## Why\nCentralizes stale lock detection logic for use by both unlock and status commands.\n\n## Pattern\nMirror: `internal/identity/identity.go` for simple utility package pattern.\n\n## Implementation\n1. Create `internal/stale/stale.go`\n2. Add `IsProcessAlive(pid int) bool` - uses `syscall.Kill(pid, 0)`\n3. Add `IsStale(lock *lockfile.Lock) (stale bool, reason string)` - checks TTL expiry OR dead PID (same host)\n4. Add build tags for Unix vs Windows\n\n## Acceptance\n- [ ] `IsProcessAlive()` returns true for current PID\n- [ ] `IsProcessAlive()` returns false for non-existent PID\n- [ ] `IsStale()` returns true for expired TTL\n- [ ] `IsStale()` returns true for dead PID on same host\n- [ ] `IsStale()` returns false for different host (cannot verify)\n- [ ] Has unit tests","notes":"env: local\nverify: agent\nmaps-to-ac: R2 PID liveness check","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:22:19.932847-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T08:25:54.412672-05:00","closed_at":"2026-01-27T08:25:54.412672-05:00","close_reason":"## Evidence\n- Created internal/stale package with PID liveness detection\n- IsProcessAlive() uses syscall.Kill(pid, 0) on Unix\n- Windows fallback returns true (conservative)\n- Check() returns stale for expired TTL or dead PID (same host)\n- All 7 unit tests pass","labels":["L-130","task"],"dependencies":[{"issue_id":"lokt-b0a.1","depends_on_id":"lokt-b0a","type":"parent-child","created_at":"2026-01-27T08:22:19.935997-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-b0a.2","title":"L-130 lock: add break-stale to Release","description":"## What\nAdd `BreakStale` option to `lock.Release()` that removes expired/stale locks only.\n\n## Why\nProvides a safe middle ground between `--force` (break-glass) and normal unlock (owner-only).\n\n## Pattern\nMirror: `internal/lock/release.go:36` - extend `ReleaseOptions` struct.\n\n## Implementation\n1. Add `BreakStale bool` to `ReleaseOptions`\n2. In `Release()`, if BreakStale:\n   - Check `stale.IsStale(existing)`\n   - If stale, remove lock (skip ownership check)\n   - If not stale, return new `ErrNotStale` error\n3. Add `ErrNotStale` error type with details\n\n## Acceptance\n- [ ] `Release(opts{BreakStale: true})` removes expired locks\n- [ ] `Release(opts{BreakStale: true})` removes dead-PID locks (same host)\n- [ ] `Release(opts{BreakStale: true})` returns `ErrNotStale` for non-stale locks\n- [ ] Existing `Force` behavior unchanged\n- [ ] Has unit tests","notes":"env: local\nverify: agent\nmaps-to-ac: R1 break-stale flag","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:22:23.694258-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T08:27:20.617404-05:00","closed_at":"2026-01-27T08:27:20.617404-05:00","close_reason":"## Evidence\n- Added BreakStale option to ReleaseOptions\n- Added ErrNotStale error and NotStaleError type\n- Release() checks stale.Check() when BreakStale is true\n- Returns NotStaleError if lock is not stale\n- All 8 release tests pass including 4 new break-stale tests","labels":["L-130","task"],"dependencies":[{"issue_id":"lokt-b0a.2","depends_on_id":"lokt-b0a","type":"parent-child","created_at":"2026-01-27T08:22:23.696431-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-b0a.2","depends_on_id":"lokt-b0a.1","type":"blocks","created_at":"2026-01-27T08:22:43.286003-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-b0a.3","title":"L-130 cli: add --break-stale to unlock command","description":"## What\nAdd `--break-stale` flag to `lokt unlock` CLI command.\n\n## Why\nExposes the safe stale-lock removal to users.\n\n## Pattern\nMirror: `cmd/lokt/main.go:119` - existing `--force` flag pattern.\n\n## Implementation\n1. Add `breakStale` flag to `cmdUnlock()`\n2. Pass to `lock.Release()` as `BreakStale` option\n3. Handle `ErrNotStale` with appropriate exit code and message\n4. Update usage text\n\n## Acceptance\n- [ ] `lokt unlock --break-stale \u003cname\u003e` removes expired locks\n- [ ] `lokt unlock --break-stale \u003cname\u003e` returns exit 1 for non-stale locks\n- [ ] Error message explains why lock is not stale\n- [ ] Usage text updated","notes":"env: local\nverify: agent\nmaps-to-ac: R1 break-stale flag","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:22:26.823089-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T08:29:11.041207-05:00","closed_at":"2026-01-27T08:29:11.041207-05:00","close_reason":"## Evidence\n- Added --break-stale flag to cmdUnlock()\n- Passes BreakStale option to lock.Release()\n- Handles NotStaleError with clear error message\n- Updated usage text with flag descriptions\n- Build and all tests pass","labels":["L-130","task"],"dependencies":[{"issue_id":"lokt-b0a.3","depends_on_id":"lokt-b0a","type":"parent-child","created_at":"2026-01-27T08:22:26.825407-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-b0a.3","depends_on_id":"lokt-b0a.2","type":"blocks","created_at":"2026-01-27T08:22:46.007736-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-b0a.4","title":"L-130 cli: enhance status with liveness display","description":"## What\nShow PID liveness status in `lokt status` output.\n\n## Why\nHelps users identify stale locks before deciding to break them.\n\n## Pattern\nMirror: `cmd/lokt/main.go:296` - existing `showLock()` function.\n\n## Implementation\n1. In `showLock()` and `showLockBrief()`, check PID liveness\n2. Display status: `alive`, `dead`, or `unknown` (cross-host)\n3. Format: `pid: 1234 (alive)` or `pid: 1234 (dead)`\n4. In brief format: add indicator like `[DEAD]`\n\n## Acceptance\n- [ ] `lokt status \u003cname\u003e` shows PID liveness status\n- [ ] `lokt status` (list) shows liveness indicator\n- [ ] Cross-host locks show `unknown`\n- [ ] JSON output includes liveness field","notes":"env: local\nverify: agent\nmaps-to-ac: R2 PID liveness check","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:22:29.559726-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T08:36:41.929526-05:00","closed_at":"2026-01-27T08:36:41.929526-05:00","close_reason":"## Evidence\n- Added pidLiveness() helper using stale.IsProcessAlive()\n- showLock() displays: pid: 1234 (alive|dead|unknown)\n- showLockBrief() adds [DEAD] marker for dead PIDs\n- Cross-host locks show 'unknown' (cannot verify)\n- All tests pass","labels":["L-130","task"],"dependencies":[{"issue_id":"lokt-b0a.4","depends_on_id":"lokt-b0a","type":"parent-child","created_at":"2026-01-27T08:22:29.561581-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-b0a.4","depends_on_id":"lokt-b0a.1","type":"blocks","created_at":"2026-01-27T08:22:49.008389-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-b0a.5","title":"L-130 cli: add --prune-expired to status","description":"## What\nAdd `--prune-expired` flag to `lokt status` that removes expired locks.\n\n## Why\nProvides convenient cleanup of expired locks during status check.\n\n## Pattern\nMirror: `cmd/lokt/main.go:153` - existing `cmdStatus()` function.\n\n## Implementation\n1. Add `pruneExpired` flag to `cmdStatus()`\n2. When listing locks, check expiry\n3. If expired and prune enabled, remove lock\n4. Report pruned locks in output\n\n## Acceptance\n- [ ] `lokt status --prune-expired` removes expired locks\n- [ ] Output shows which locks were pruned\n- [ ] Non-expired locks are not affected\n- [ ] Works with specific lock name: `lokt status --prune-expired \u003cname\u003e`","notes":"env: local\nverify: agent\nmaps-to-ac: R3 auto-prune expired","status":"closed","priority":3,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:22:32.40278-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T09:00:17.473691-05:00","closed_at":"2026-01-27T09:00:17.473691-05:00","close_reason":"## Evidence\n- Added --prune-expired flag to cmdStatus()\n- When listing, expired locks are removed and reported\n- When viewing specific lock with prune, removes if expired\n- Output shows 'pruned: {name} (expired)' and summary count\n- All tests pass\n- CLI tested manually with expired locks","labels":["L-130","task"],"dependencies":[{"issue_id":"lokt-b0a.5","depends_on_id":"lokt-b0a","type":"parent-child","created_at":"2026-01-27T08:22:32.40532-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-b0a.6","title":"L-130 cli: validate TTL duration","description":"## What\nValidate that TTL durations are positive values.\n\n## Why\nPrevents confusing behavior from zero or negative TTL.\n\n## Pattern\nMirror: `cmd/lokt/main.go:87` - existing TTL flag parsing.\n\n## Implementation\n1. After parsing `--ttl` flag, validate \u003e 0\n2. If zero or negative, print error and return ExitUsage\n3. Apply to both `lock` and `guard` commands\n\n## Acceptance\n- [ ] `lokt lock --ttl 0 foo` produces error\n- [ ] `lokt lock --ttl -5m foo` produces error\n- [ ] Error message is clear about valid values\n- [ ] `lokt guard --ttl 0 foo -- cmd` same behavior","notes":"env: local\nverify: agent\nmaps-to-ac: R4 duration validation","status":"closed","priority":3,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:22:35.267113-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T09:03:22.438576-05:00","closed_at":"2026-01-27T09:03:22.438576-05:00","close_reason":"## Evidence\n- Added TTL validation to cmdLock() and cmdGuard()\n- Negative TTL rejected with 'TTL must be positive' error\n- Exit code 64 (ExitUsage) for invalid TTL\n- Zero TTL allowed (means no TTL - lock never expires)\n- Positive TTL works as expected\n- All tests pass","labels":["L-130","task"],"dependencies":[{"issue_id":"lokt-b0a.6","depends_on_id":"lokt-b0a","type":"parent-child","created_at":"2026-01-27T08:22:35.268922-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-eie","title":"L-140 lock-wait","description":"## Summary\nAdd `--wait` flag to `lokt lock` command that polls until the lock is acquired. Foundation for wait/timeout/backoff features (L-141, L-142, L-143).\n\n## Acceptance Criteria\n- [ ] **Basic wait**: Given lock is held, when `lokt lock --wait foo` runs, then it polls until lock is released and acquires it\n- [ ] **Indefinite wait**: Given `--wait` with no timeout, waits indefinitely until signal\n- [ ] **Signal handling**: Given waiting, when SIGINT received, exits cleanly with non-zero code\n- [ ] **Exit code on success**: When acquired, exit code is 0\n- [ ] **TTL preserved**: `--wait` combined with `--ttl 5m` sets TTL correctly\n- [ ] **Stale lock handling**: If lock is stale (expired TTL or dead PID), auto-break and acquire\n\n## Plan\n\n### Strategy\nAdd `AcquireWithWait` function to `internal/lock` package that wraps `Acquire` in a context-aware polling loop. Use 100ms polling interval (hardcoded for L-140, configurable in L-142).\n\n### Patterns\n- Mirror: `cmdGuard` signal handling pattern in `main.go:321-324`\n- Mirror: `stale.Check()` for stale lock detection during wait\n\n### Key Decisions\n- Use context.Context for cancellation (enables clean signal handling)\n- Hardcode 100ms poll interval (L-142 will add backoff/jitter)\n- Auto-break stale locks during wait (better UX than waiting forever)\n\n## Edge Cases\n- Lock released between check and acquire (race) — retry loop handles this\n- Lock file deleted externally — acquire succeeds on next poll\n- Lock held by same owner — current re-entrant behavior preserved\n\n## Constraints\n- Polling interval hardcoded (100ms) — L-142 adds configurability\n- No progress output — L-143 adds this\n- Must not break existing non-wait behavior","notes":"source: _notes/story-drafts/l-140-lock-wait.md\nverify-level: optional\nverify-envs: sandbox","status":"open","priority":2,"issue_type":"epic","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T13:59:41.012757-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T13:59:41.012757-05:00"}
{"id":"lokt-eie.1","title":"L-140 lock: add AcquireWithWait function","description":"## What\nAdd `AcquireWithWait` function to `internal/lock/acquire.go` that polls until lock is acquired or context is cancelled.\n\n## Why\nEncapsulates polling logic in reusable function. Context-based cancellation enables clean signal handling. Prepares for L-141 timeout and L-142 backoff.\n\n## Pattern\nMirror: `stale.Check()` for detecting stale locks to auto-break\n\n## Implementation\n```go\nfunc AcquireWithWait(ctx context.Context, rootDir, name string, opts AcquireOptions) error {\n    // First attempt without wait\n    err := Acquire(rootDir, name, opts)\n    if err == nil {\n        return nil\n    }\n    var held *HeldError\n    if !errors.As(err, \u0026held) {\n        return err // non-held error, don't retry\n    }\n    \n    ticker := time.NewTicker(100 * time.Millisecond)\n    defer ticker.Stop()\n    \n    for {\n        select {\n        case \u003c-ctx.Done():\n            return ctx.Err()\n        case \u003c-ticker.C:\n            // Check if stale, auto-break if so\n            if tryBreakStale(rootDir, name) {\n                // Stale lock broken, try acquire\n            }\n            err := Acquire(rootDir, name, opts)\n            if err == nil {\n                return nil\n            }\n            if !errors.As(err, \u0026held) {\n                return err\n            }\n        }\n    }\n}\n```\n\n## Acceptance\n- [ ] Function signature: `AcquireWithWait(ctx context.Context, rootDir, name string, opts AcquireOptions) error`\n- [ ] Returns nil on successful acquire\n- [ ] Returns ctx.Err() on context cancellation\n- [ ] Auto-breaks stale locks (expired TTL or dead PID)\n- [ ] Uses 100ms polling interval","notes":"env: local\nverify: agent\nmaps-to-ac: basic-wait,stale-lock-handling","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T13:59:54.505014-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T14:03:13.612682-05:00","closed_at":"2026-01-27T14:03:13.612682-05:00","close_reason":"Implemented AcquireWithWait with context-based cancellation and stale lock auto-break. Commit: 805be86","dependencies":[{"issue_id":"lokt-eie.1","depends_on_id":"lokt-eie","type":"parent-child","created_at":"2026-01-27T13:59:54.507328-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-eie.2","title":"L-140 cli: add --wait flag to lock command","description":"## What\nAdd `--wait` boolean flag to `cmdLock` function that enables polling behavior.\n\n## Why\nUser-facing interface for the wait feature. Integrates with signal handling for clean cancellation.\n\n## Pattern\nMirror: signal handling in `cmdGuard` (main.go:321-324)\n\n## Implementation\n```go\nfunc cmdLock(args []string) int {\n    fs := flag.NewFlagSet(\"lock\", flag.ExitOnError)\n    ttl := fs.Duration(\"ttl\", 0, \"Lock TTL (e.g., 5m, 1h)\")\n    wait := fs.Bool(\"wait\", false, \"Wait for lock to be free\")\n    // ...\n    \n    if *wait {\n        ctx, cancel := signal.NotifyContext(context.Background(), syscall.SIGINT, syscall.SIGTERM)\n        defer cancel()\n        \n        err = lock.AcquireWithWait(ctx, rootDir, name, lock.AcquireOptions{TTL: *ttl})\n        if err != nil {\n            if errors.Is(err, context.Canceled) {\n                return ExitError  // Signal received\n            }\n            // handle HeldError (shouldn't happen with infinite wait)\n        }\n    } else {\n        err = lock.Acquire(rootDir, name, lock.AcquireOptions{TTL: *ttl})\n    }\n}\n```\n\n## Acceptance\n- [ ] `--wait` flag added to lock command\n- [ ] Flag documented in usage()\n- [ ] Signal handling (SIGINT/SIGTERM) cancels wait cleanly\n- [ ] Exit code 0 on success, non-zero on signal/error\n- [ ] TTL flag works with --wait","notes":"env: local\nverify: agent\nmaps-to-ac: signal-handling,ttl-preserved,exit-code-on-success","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T14:00:06.071877-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T14:04:54.88795-05:00","closed_at":"2026-01-27T14:04:54.88795-05:00","close_reason":"Added --wait flag with signal handling. Commit: a5c8cee","dependencies":[{"issue_id":"lokt-eie.2","depends_on_id":"lokt-eie","type":"parent-child","created_at":"2026-01-27T14:00:06.073875-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-eie.2","depends_on_id":"lokt-eie.1","type":"blocks","created_at":"2026-01-27T14:00:12.442671-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-eie.3","title":"L-140 test: add wait behavior tests","description":"## What\nAdd unit tests for `AcquireWithWait` function covering wait, cancellation, and stale lock scenarios.\n\n## Why\nVerify polling logic, context cancellation, and stale lock auto-break work correctly.\n\n## Pattern\nMirror: existing tests in `internal/lock/acquire_test.go`\n\n## Test Cases\n1. **Wait succeeds when lock released**: Start goroutine that releases lock after delay, verify AcquireWithWait succeeds\n2. **Context cancellation**: Cancel context during wait, verify returns ctx.Err()\n3. **Stale lock broken**: Create expired lock, verify AcquireWithWait auto-breaks and acquires\n4. **Dead PID broken**: Create lock with dead PID (same host), verify auto-break\n5. **Immediate success**: No contention, verify returns immediately without polling\n\n## Acceptance\n- [ ] Test wait succeeds after lock released\n- [ ] Test context cancellation during wait\n- [ ] Test stale lock (expired TTL) auto-break\n- [ ] Test dead PID lock auto-break\n- [ ] Tests pass: `go test ./internal/lock/...`","notes":"env: local\nverify: agent\nmaps-to-ac: basic-wait,signal-handling,stale-lock-handling","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T14:00:22.58201-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T14:06:15.199484-05:00","closed_at":"2026-01-27T14:06:15.199484-05:00","close_reason":"Added 6 unit tests for AcquireWithWait. Commit: 18fbfd3","dependencies":[{"issue_id":"lokt-eie.3","depends_on_id":"lokt-eie","type":"parent-child","created_at":"2026-01-27T14:00:22.584437-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-eie.3","depends_on_id":"lokt-eie.1","type":"blocks","created_at":"2026-01-27T14:00:27.975224-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-h9g","title":"L-186/187 verify:sandbox","description":"Verification for L-186/187 GitHub Release Pipeline\n\nLinked story: lokt-uyq\n\n## Scope\n- Agent-verifiable: goreleaser dry-run, workflow syntax validation\n- Human-verifiable: Actual tag push and release creation (requires pre-release tag)\n\n## Environments\nsandbox (test with pre-release tag like v0.0.1-test)","notes":"linked-story: lokt-uyq\nverify-level: required","status":"closed","priority":3,"issue_type":"epic","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T11:36:57.089062-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T13:37:10.113052-05:00","closed_at":"2026-01-27T13:37:10.113052-05:00","close_reason":"All verification tasks passed.","labels":["L-186","L-187","verification"]}
{"id":"lokt-h9g.1","title":"L-186 verify:local goreleaser dry-run","description":"## Check\nVerify goreleaser config is valid and produces expected artifacts.\n\n## Command\n```bash\ngoreleaser check\ngoreleaser build --snapshot --clean\nls dist/\n```\n\n## Expected\n- goreleaser check passes\n- Build produces binaries for all 4 platforms (darwin/linux × amd64/arm64)\n- Binaries show correct version when run","notes":"env: local\nverify: agent\nmaps-to-ac: Binaries work","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T11:37:15.110329-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T13:32:08.230689-05:00","closed_at":"2026-01-27T13:32:08.230689-05:00","close_reason":"goreleaser check passes. Snapshot build produces 4 binaries (darwin/linux × amd64/arm64). Version output shows correct version/commit/date.","labels":["L-186","verification","verify-agent"],"dependencies":[{"issue_id":"lokt-h9g.1","depends_on_id":"lokt-h9g","type":"parent-child","created_at":"2026-01-27T11:37:15.112039-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-h9g.1","depends_on_id":"lokt-uyq.2","type":"blocks","created_at":"2026-01-27T11:37:28.408053-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-h9g.2","title":"L-186 verify:local workflow syntax","description":"## Check\nVerify GitHub Actions workflow YAML is valid.\n\n## Command\n```bash\n# Check YAML syntax\npython3 -c 'import yaml; yaml.safe_load(open(\".github/workflows/ci.yml\"))'\npython3 -c 'import yaml; yaml.safe_load(open(\".github/workflows/release.yml\"))'\n```\n\n## Expected\n- No YAML syntax errors\n- Workflows parse successfully","notes":"env: local\nverify: agent\nmaps-to-ac: CI runs on PR","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T11:37:17.424949-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T11:40:31.57032-05:00","closed_at":"2026-01-27T11:40:31.57032-05:00","close_reason":"All workflow YAML files validated with Ruby YAML parser. ci.yml, release.yml, .goreleaser.yml all parse successfully.","labels":["L-186","verification","verify-agent"],"dependencies":[{"issue_id":"lokt-h9g.2","depends_on_id":"lokt-h9g","type":"parent-child","created_at":"2026-01-27T11:37:17.427066-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-h9g.2","depends_on_id":"lokt-uyq.3","type":"blocks","created_at":"2026-01-27T11:37:28.57301-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-h9g.3","title":"L-186 verify:github push PR and check CI","description":"## Check\nVerify CI workflow runs correctly on GitHub.\n\n## Steps\n1. Push changes to a branch\n2. Open PR to main\n3. Verify CI runs on both ubuntu-latest and macos-latest\n4. Verify all jobs pass (test + lint on both OS)\n\n## Expected\n- CI triggered automatically on PR\n- Matrix shows 2 OS runners\n- All checks pass","notes":"env: github\nverify: human\nmaps-to-ac: CI runs on PR","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T11:37:19.748853-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T13:19:52.485026-05:00","closed_at":"2026-01-27T13:19:52.485026-05:00","close_reason":"CI passes on GitHub with ubuntu-latest and macos-latest matrix. All jobs green.","labels":["L-186","verification","verify-human"],"dependencies":[{"issue_id":"lokt-h9g.3","depends_on_id":"lokt-h9g","type":"parent-child","created_at":"2026-01-27T11:37:19.750977-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-h9g.3","depends_on_id":"lokt-uyq.1","type":"blocks","created_at":"2026-01-27T11:37:28.754872-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-h9g.4","title":"L-187 verify:github test release with pre-release tag","description":"## Check\nVerify release workflow creates GitHub Release with binaries.\n\n## Steps\n1. Create and push a test tag: git tag v0.0.1-test \u0026\u0026 git push origin v0.0.1-test\n2. Watch Actions tab for release workflow\n3. Verify GitHub Release created with:\n   - 4 binary archives (darwin/linux × amd64/arm64)\n   - checksums.txt file\n   - Auto-generated changelog\n4. Download a binary, run `lokt version`, verify output matches tag\n5. Delete test release and tag when done\n\n## Expected\n- Release workflow triggered by tag\n- All binaries present and downloadable\n- Version shows v0.0.1-test","notes":"env: github\nverify: human\nmaps-to-ac: Release on tag, Binaries work, Checksums present","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T11:37:22.154576-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T13:37:03.979869-05:00","closed_at":"2026-01-27T13:37:03.979869-05:00","close_reason":"Release workflow passed. GitHub Release created with 4 binary archives and checksums.txt.","labels":["L-187","verification","verify-human"],"dependencies":[{"issue_id":"lokt-h9g.4","depends_on_id":"lokt-h9g","type":"parent-child","created_at":"2026-01-27T11:37:22.15637-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-h9g.4","depends_on_id":"lokt-uyq.3","type":"blocks","created_at":"2026-01-27T11:37:28.920995-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-lb2","title":"L-103 lock-name-validation","description":"## Summary\nValidate lock names to prevent path traversal and invalid characters.\n\n## Acceptance Criteria\n- Valid names (alphanumeric, dots, hyphens, underscores) accepted\n- Path traversal (`../`) rejected with clear error\n- Absolute paths rejected\n- Empty names rejected\n- Special characters rejected\n\n## Plan\n\n### Strategy\nAdd a ValidateName function in internal/lockfile package, call it early in Acquire/Release.\n\n### Pattern\n- Regex: `^[A-Za-z0-9._-]+$`\n- Explicit check for `..` substring\n- Check for leading `/`\n\n## Edge Cases\n- `foo.bar` — valid\n- `foo..bar` — invalid (contains `..`)\n- `.hidden` — valid\n\n## Constraints\n- Validate before any file operations\n- Same validation for all commands","status":"closed","priority":2,"issue_type":"epic","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T10:08:03.670899-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T10:13:17.660549-05:00","closed_at":"2026-01-27T10:13:17.660549-05:00","close_reason":"L-103 complete: ValidateName added, integrated, tested, pushed"}
{"id":"lokt-uyq","title":"L-186/187 github-release-pipeline","description":"## Summary\nAutomated CI/CD pipeline: tests on PR/push (Linux + macOS matrix), and goreleaser-based releases on version tags with cross-platform binaries.\n\n## Acceptance Criteria\n- [ ] CI runs on PR: tests pass on ubuntu-latest and macos-latest\n- [ ] CI runs on push to main: build + test succeeds\n- [ ] Release on tag: v* tag triggers GitHub Release with binaries\n- [ ] Binaries work: lokt version shows correct version/commit/date\n- [ ] Checksums present: SHA256 sums in checksums.txt match binaries\n\n## Plan\n\n### Strategy\nExtend existing ci.yml with macOS matrix. Add release.yml workflow using goreleaser action. Configure .goreleaser.yml with same ldflags pattern as scripts/build.sh.\n\n### Patterns\n- Mirror: `scripts/build.sh` for ldflags: -X main.version, -X main.commit, -X main.date\n- goreleaser archives as tar.gz with platform-specific naming\n\n### Key Decisions\n- No Windows: stale detection is Unix-only\n- No Homebrew: future work (non-goal per story)\n- No signing: deferred\n\n## Edge Cases\n- Tag without v prefix: ignored, no release\n- Failed tests on release: release aborted\n- Concurrent releases: goreleaser handles atomically\n\n## Constraints\n- GitHub-hosted runners (free for public repos)\n- goreleaser for cross-compilation\n- Same ldflags as scripts/build.sh","notes":"source: _notes/story-drafts/l-186-187-github-release-pipeline.md\nverify-level: required\nverify-envs: sandbox","status":"closed","priority":2,"issue_type":"epic","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T11:36:21.396744-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T13:37:09.962313-05:00","closed_at":"2026-01-27T13:37:09.962313-05:00","close_reason":"L-186/187 complete. CI matrix + goreleaser release pipeline working.","labels":["L-186","L-187","story"]}
{"id":"lokt-uyq.1","title":"L-186 ci: add macOS matrix to CI workflow","description":"## What\nUpdate .github/workflows/ci.yml to run tests on both ubuntu-latest and macos-latest using a matrix strategy.\n\n## Why\nStory requirement: CI must pass on both Linux and macOS.\n\n## Pattern\nMirror existing ci.yml structure, add matrix.os.\n\n## Acceptance\n- [ ] CI workflow uses matrix with [ubuntu-latest, macos-latest]\n- [ ] Both OS runners execute test and lint jobs\n- [ ] Workflow passes on both platforms","notes":"env: local\nverify: agent\nmaps-to-ac: CI runs on PR, CI runs on push","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T11:36:36.892571-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T11:40:19.900097-05:00","closed_at":"2026-01-27T11:40:19.900097-05:00","close_reason":"Added matrix strategy to ci.yml with [ubuntu-latest, macos-latest]. Both OS runners execute test and lint jobs. YAML validated.","labels":["L-186","task"],"dependencies":[{"issue_id":"lokt-uyq.1","depends_on_id":"lokt-uyq","type":"parent-child","created_at":"2026-01-27T11:36:36.894386-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-uyq.2","title":"L-186 release: create goreleaser config","description":"## What\nCreate .goreleaser.yml with builds for darwin/linux on amd64/arm64, tar.gz archives, and checksums.\n\n## Why\ngoreleaser handles cross-compilation and release artifact creation.\n\n## Pattern\nMirror: `scripts/build.sh` for ldflags\n\n## Acceptance\n- [ ] .goreleaser.yml exists with darwin+linux builds\n- [ ] ldflags match scripts/build.sh (-X main.version, etc.)\n- [ ] Archive format is tar.gz with lokt_{version}_{os}_{arch} naming\n- [ ] checksums.txt configured","notes":"env: local\nverify: agent\nmaps-to-ac: Binaries work, Checksums present","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T11:36:39.237743-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T11:40:22.221304-05:00","closed_at":"2026-01-27T11:40:22.221304-05:00","close_reason":"Created .goreleaser.yml with darwin+linux builds on amd64/arm64. ldflags match scripts/build.sh. tar.gz archives with lokt_{version}_{os}_{arch} naming. checksums.txt configured.","labels":["L-186","task"],"dependencies":[{"issue_id":"lokt-uyq.2","depends_on_id":"lokt-uyq","type":"parent-child","created_at":"2026-01-27T11:36:39.241401-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-uyq.3","title":"L-187 release: create release workflow","description":"## What\nCreate .github/workflows/release.yml triggered by v* tags, running goreleaser to create GitHub Release with binaries.\n\n## Why\nAutomated releases on tag push, no manual steps.\n\n## Pattern\nStandard goreleaser GitHub Action pattern.\n\n## Acceptance\n- [ ] release.yml triggers on push of v* tags\n- [ ] Workflow uses goreleaser-action\n- [ ] Release workflow requires tests to pass first\n- [ ] GitHub Release created with binaries attached","notes":"env: local\nverify: agent\nmaps-to-ac: Release on tag","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T11:36:41.888144-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T11:40:24.512064-05:00","closed_at":"2026-01-27T11:40:24.512064-05:00","close_reason":"Created release.yml triggered on v* tags. Uses goreleaser-action v6. Tests run first (needs: test). Creates GitHub Release with binaries.","labels":["L-187","task"],"dependencies":[{"issue_id":"lokt-uyq.3","depends_on_id":"lokt-uyq","type":"parent-child","created_at":"2026-01-27T11:36:41.890654-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-uyq.3","depends_on_id":"lokt-uyq.2","type":"blocks","created_at":"2026-01-27T11:36:48.842199-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-y24","title":"L-130 verify:local","description":"Verification for L-130 TTL \u0026 Stale Lock Handling\n\nLinked story: lokt-b0a\n\n## Scope\n- Agent-verifiable: Unit tests, CLI tests\n\n## Environments\nlocal","notes":"linked-story: lokt-b0a\nverify-level: agent","status":"closed","priority":3,"issue_type":"epic","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:22:57.436712-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T09:24:30.135906-05:00","closed_at":"2026-01-27T09:24:30.135906-05:00","close_reason":"All verification tasks passed","labels":["L-130","verification"]}
{"id":"lokt-y24.1","title":"L-130 verify:local unit tests pass","description":"## Check\nAll unit tests pass including new stale detection tests.\n\n## Command\n```bash\ngo test ./...\n```\n\n## Expected\nAll tests pass, including:\n- internal/stale tests\n- internal/lock/release_test.go with break-stale cases","notes":"env: local\nverify: agent\nmaps-to-ac: all","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:23:11.511272-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T09:06:41.669493-05:00","closed_at":"2026-01-27T09:06:41.669493-05:00","close_reason":"## Evidence\n- All unit tests pass\n- internal/stale: 7 tests (PID liveness, TTL expiry, cross-host)\n- internal/lock: 12 tests (acquire race, release, break-stale)\n- internal/lockfile: 4 tests (expiry, read/write)\n- Total: 23 tests passing","labels":["L-130","verification","verify-agent"],"dependencies":[{"issue_id":"lokt-y24.1","depends_on_id":"lokt-y24","type":"parent-child","created_at":"2026-01-27T08:23:11.513044-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-y24.2","title":"L-130 verify:local --break-stale works","description":"## Check\n`unlock --break-stale` correctly removes expired locks and rejects non-stale locks.\n\n## Steps\n```bash\n# Create expired lock\nlokt lock --ttl 1s test-stale\nsleep 2\n\n# Should succeed (lock is expired)\nlokt unlock --break-stale test-stale\necho \"Exit code: $?\"\n\n# Create non-expired lock\nlokt lock --ttl 5m test-active\n\n# Should fail (lock not stale)\nlokt unlock --break-stale test-active\necho \"Exit code: $?\"\n\n# Cleanup\nlokt unlock --force test-active\n```\n\n## Expected\n- First unlock succeeds (exit 0)\n- Second unlock fails with \"not stale\" message (exit 1)","notes":"env: local\nverify: agent\nmaps-to-ac: R1","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:23:14.326902-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T09:15:20.460718-05:00","closed_at":"2026-01-27T09:15:20.460718-05:00","close_reason":"## Evidence\n- Expired TTL lock: --break-stale succeeds (exit 0)\n- Dead PID on same host: --break-stale succeeds (exit 0) - correct behavior\n- Cross-host lock without TTL: --break-stale fails (exit 1) with message 'cannot verify PID on remote host'\n- Error messages are clear and descriptive\n- All scenarios work as designed","labels":["L-130","verification","verify-agent"],"dependencies":[{"issue_id":"lokt-y24.2","depends_on_id":"lokt-y24","type":"parent-child","created_at":"2026-01-27T08:23:14.329341-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-y24.3","title":"L-130 verify:local status shows liveness","description":"## Check\n`lokt status` displays PID liveness information.\n\n## Steps\n```bash\n# Create a lock\nlokt lock test-liveness\n\n# Check status shows alive (our PID)\nlokt status test-liveness\n\n# Cleanup\nlokt unlock test-liveness\n```\n\n## Expected\n- Status output includes `pid: \u003cnumber\u003e (alive)` or similar\n- Brief listing shows liveness indicator","notes":"env: local\nverify: agent\nmaps-to-ac: R2","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T08:23:16.807211-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T09:16:18.975464-05:00","closed_at":"2026-01-27T09:16:18.975464-05:00","close_reason":"## Evidence\n- Detailed status shows: pid: 6219 (dead) for same-host locks\n- Detailed status shows: pid: 12345 (unknown) for cross-host locks\n- Brief status shows [DEAD] marker for dead PIDs\n- Brief status shows no marker for unknown (cannot verify)\n- All liveness states displayed correctly","labels":["L-130","verification","verify-agent"],"dependencies":[{"issue_id":"lokt-y24.3","depends_on_id":"lokt-y24","type":"parent-child","created_at":"2026-01-27T08:23:16.808984-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-z8x","title":"L-126: Add --json flag to status command","description":"Machine-readable JSON output for lokt status. Enables scripting, CI/CD integration, and monitoring tools to parse lock state reliably.","status":"closed","priority":2,"issue_type":"epic","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T13:49:28.20629-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T13:53:24.005757-05:00","closed_at":"2026-01-27T13:53:24.005757-05:00","close_reason":"L-126 complete: status --json outputs machine-readable JSON"}
{"id":"lokt-z8x.1","title":"Add StatusOutput struct with computed fields","description":"Create output struct embedding Lock plus age_sec, expired, pid_status computed fields for JSON marshaling","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T13:49:47.104204-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T13:53:09.372591-05:00","closed_at":"2026-01-27T13:53:09.372591-05:00","close_reason":"Implemented StatusOutput struct and --json flag","dependencies":[{"issue_id":"lokt-z8x.1","depends_on_id":"lokt-z8x","type":"parent-child","created_at":"2026-01-27T13:49:47.106973-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-z8x.2","title":"Implement --json flag for status command","description":"Add --json bool flag. For single lock: output JSON object. For list: output JSON array. Handle empty list ([]). Works with --prune-expired.","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T13:49:50.307974-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T13:53:09.406412-05:00","closed_at":"2026-01-27T13:53:09.406412-05:00","close_reason":"Implemented StatusOutput struct and --json flag","dependencies":[{"issue_id":"lokt-z8x.2","depends_on_id":"lokt-z8x","type":"parent-child","created_at":"2026-01-27T13:49:50.309841-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-z8x.2","depends_on_id":"lokt-z8x.1","type":"blocks","created_at":"2026-01-27T13:50:00.934804-05:00","created_by":"Nikola Savic"}]}
{"id":"lokt-z8x.3","title":"Add tests for status --json","description":"Test JSON output for: single lock, list, empty list, not found error, combined with --prune-expired","status":"closed","priority":2,"issue_type":"task","owner":"nikolasavic@gmail.com","created_at":"2026-01-27T13:49:54.086878-05:00","created_by":"Nikola Savic","updated_at":"2026-01-27T13:53:17.120659-05:00","closed_at":"2026-01-27T13:53:17.120659-05:00","close_reason":"Manual testing: empty list [], single lock JSON, list JSON, not found error code 3","dependencies":[{"issue_id":"lokt-z8x.3","depends_on_id":"lokt-z8x","type":"parent-child","created_at":"2026-01-27T13:49:54.088838-05:00","created_by":"Nikola Savic"},{"issue_id":"lokt-z8x.3","depends_on_id":"lokt-z8x.2","type":"blocks","created_at":"2026-01-27T13:50:01.087744-05:00","created_by":"Nikola Savic"}]}
